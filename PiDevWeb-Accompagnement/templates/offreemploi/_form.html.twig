{% if form.vars.errors|length > 0 %}
    <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
        <div class="d-flex">
            <div class="flex-shrink-0">
                <i class="ti ti-alert-circle fs-4"></i>
            </div>
            <div class="flex-grow-1 ms-3">
                <h5 class="alert-heading">Form Validation Errors</h5>
                <ul class="mb-0">
                    {% for error in form.vars.errors %}
                        <li>{{ error.message }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endif %}

{{ form_start(form, {
    'attr': {
        'class': 'needs-validation',
        'novalidate': 'novalidate',
        'enctype': 'multipart/form-data'
    }
}) }}

{# Debug information #}
<div class="d-none">
    Form action: {{ form.vars.action }}
    CSRF token: {{ csrf_token('offreemploi_form') }}
</div>

<div class="alert alert-danger d-none" id="form-error-alert">
    <div class="d-flex">
        <div class="flex-shrink-0">
            <i class="ti ti-alert-circle fs-4"></i>
        </div>
        <div class="flex-grow-1 ms-3">
            <h5 class="alert-heading">Form Validation Errors</h5>
            <div class="alert-message"></div>
        </div>
    </div>
</div>

<div class="row g-4">
    {# Job Title #}
    <div class="col-12">
        <div class="form-group">
            {{ form_label(form.titre, 'Job Title *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-briefcase"></i></span>
                {{ form_widget(form.titre, {
                    'attr': {
                        'class': 'form-control' ~ (not form.titre.vars.valid ? ' is-invalid'),
                        'placeholder': 'Enter job title',
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.titre) }}
                </div>
            </div>
        </div>
    </div>

    {# Job Type and Contract Type #}
    <div class="col-md-6">
        <div class="form-group">
            {{ form_label(form.typeposte, 'Job Type *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-clock"></i></span>
                {{ form_widget(form.typeposte, {
                    'attr': {
                        'class': 'form-select' ~ (not form.typeposte.vars.valid ? ' is-invalid'),
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.typeposte) }}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="form-group">
            {{ form_label(form.typecontrat, 'Contract Type *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-file-contract"></i></span>
                {{ form_widget(form.typecontrat, {
                    'attr': {
                        'class': 'form-select' ~ (not form.typecontrat.vars.valid ? ' is-invalid'),
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.typecontrat) }}
                </div>
            </div>
        </div>
    </div>

    {# Location and Status #}
    <div class="col-md-6">
        <div class="form-group">
            {{ form_label(form.emplacement, 'Location *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-map-pin"></i></span>
                {{ form_widget(form.emplacement, {
                    'attr': {
                        'class': 'form-select' ~ (not form.emplacement.vars.valid ? ' is-invalid'),
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.emplacement) }}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="form-group">
            {{ form_label(form.etat, 'Status *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-toggle-right"></i></span>
                {{ form_widget(form.etat, {
                    'attr': {
                        'class': 'form-select' ~ (not form.etat.vars.valid ? ' is-invalid'),
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.etat) }}
                </div>
            </div>
        </div>
    </div>

    {# Description #}
    <div class="col-12">
        <div class="form-group">
            {{ form_label(form.description, 'Job Description *', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-text"></i></span>
                {{ form_widget(form.description, {
                    'attr': {
                        'class': 'form-control' ~ (not form.description.vars.valid ? ' is-invalid'),
                        'rows': '6',
                        'placeholder': 'Enter detailed job description',
                        'required': true
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.description) }}
                </div>
            </div>
        </div>
    </div>

    {# Image Upload #}
    <div class="col-12">
        <div class="form-group">
            {{ form_label(form.imageurl, 'Company Logo or Job Image', {'label_attr': {'class': 'form-label fw-medium'}}) }}
            <div class="input-group">
                <span class="input-group-text"><i class="ti ti-photo"></i></span>
                {{ form_widget(form.imageurl, {
                    'attr': {
                        'class': 'form-control' ~ (not form.imageurl.vars.valid ? ' is-invalid'),
                        'accept': 'image/jpeg,image/png'
                    }
                }) }}
                <div class="invalid-feedback">
                    {{ form_errors(form.imageurl) }}
                </div>
            </div>
            <div class="form-text">Upload a company logo or relevant image (JPEG, PNG - max 2MB)</div>
        </div>
    </div>
</div>

{# Ensure all form fields are rendered, including hidden ones #}
{{ form_rest(form) }}

<div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
    <button type="button" class="btn btn-light" data-bs-dismiss="modal">
        <i class="ti ti-x me-1"></i>Cancel
    </button>
    <button type="submit" class="btn btn-primary">
        <i class="ti ti-device-floppy me-1"></i>Save
    </button>
</div>

{{ form_end(form) }}