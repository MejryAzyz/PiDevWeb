{% extends 'baseFront.html.twig' %}

{% block title %}Nos Cliniques - Emigrar{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        .search-input {
            position: relative;
            height: 100%;
        }
        .search-input i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            z-index: 1;
        }
        .search-input select, 
        .search-input input,
        .search-button {
            height: 50px !important;
            padding-left: 40px !important;
        }
        .search-button {
            width: 100%;
            height: 50px !important;
            padding: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
        }
        .search-button i {
            margin-right: 8px;
        }
        .rt-banner-searchbox {
            padding: 15px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .search-row {
            margin: 0 -10px;
        }
        .search-col {
            padding: 0 10px;
        }
    </style>
{% endblock %}

{% block body %}
<div class="rt-breadcump rt-breadcump-height">
    <div class="rt-page-bg rtbgprefix-cover" style="background-image: url({{ asset('coderthemes.com/osen/layouts/assets/images/backgrounds/bredcump.png') }})">
    </div>
    <div class="container">
        <div class="row rt-breadcump-height">
            <div class="col-12">
                <div class="breadcrumbs-content">
                    <h3>Nos Cliniques</h3>
                    <div class="breadcrumbs">
                        <span class="divider"><i class="icofont-home"></i></span>
                        <a href="#" title="Accueil">Accueil</a>
                        <span class="divider"><i class="icofont-simple-right"></i></span>
                        Nos Cliniques
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bredcump--search-trip">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div class="rt-banner-searchbox trip-search">
                        <form action="{{ path('app_clinique_front_index') }}" method="get" class="rt-input-group">
                            <div class="row search-row">
                                <div class="col-md-5 search-col">
                                    <div class="search-input">
                                        <i class="icofont-world"></i>
                                        <input type="text" class="form-control" name="pays" placeholder="Rechercher par pays" value="{{ app.request.query.get('pays') }}">
                                    </div>
                                </div>
                                <div class="col-md-4 search-col">
                                    <div class="search-input">
                                        <i class="icofont-doctor"></i>
                                        <select name="specialty" class="form-control">
                                            <option value="">Toutes les spécialités</option>
                                            {% for specialite in specialites %}
                                                <option value="{{ specialite.id_specialite }}" {% if app.request.query.get('specialty') == specialite.id_specialite %}selected{% endif %}>
                                                    {{ specialite.nom }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3 search-col">
                                    <button type="submit" class="rt-btn rt-gradient pill text-uppercase search-button">
                                        <i class="icofont-search"></i> Rechercher
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="spacer-bottom"></div>
<section class="content-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 mx-auto col-md-7 mb-5 mb-lg-0">
                <div class="rt-sidebar-group">
                    <div class="rt-widget widget_range-slider">
                        <h3 class="rt-widget-title">Filtrer par prix</h3>
                        <form action="{{ path('app_clinique_front_index') }}" method="get" id="price-filter-form">
                            <input type="hidden" name="page" value="{{ currentPage|default(1) }}">
                            <div class="slider-range" id="price-range"></div>
                            <div class="price_slider_amount mt-4">
                                <div class="clearfix">
                                    <div class="float-left">
                                        <span>Prix :</span>
                                    </div>
                                    <div class="float-right">
                                        <input type="text" id="price-amount" readonly style="border:0; font-weight:bold;" name="price_range">
                                    </div>
                                </div>
                            </div>
                            <div class="text-center mt-4">
                                <button type="submit" class="rt-btn rt-gradient rounded-sm rt-sm text-uppercase">Filtrer</button>
                            </div>
                        </form>
                    </div>
                    <div class="rt-widget widget_specialty-filter">
                        <h3 class="rt-widget-title">Filtrer par spécialité</h3>
                        <form action="{{ path('app_clinique_front_index') }}" method="get" id="specialty-filter-form">
                            <select name="specialty" class="form-control">
                                <option value="">Toutes les spécialités</option>
                                {% for specialite in specialites %}
                                    <option value="{{ specialite.id_specialite }}">{{ specialite.nom }}</option>
                                {% endfor %}
                            </select>
                            <div class="text-center mt-4">
                                <button type="submit" class="rt-btn rt-gradient rounded-sm rt-sm text-uppercase">Filtrer</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="box-style__1 rt-mb-30">
                    <form action="{{ path('app_clinique_front_index') }}" method="get" class="row">
                        <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                            <select name="sort" class="rt-selectactive banner-select" style="width: 100%">
                                <option value="recommande" {% if app.request.query.get('sort') == 'recommande' %}selected{% endif %}>Recommandé</option>
                                <option value="prix_asc" {% if app.request.query.get('sort') == 'prix_asc' %}selected{% endif %}>Prix croissant</option>
                                <option value="prix_desc" {% if app.request.query.get('sort') == 'prix_desc' %}selected{% endif %}>Prix décroissant</option>
                                <option value="docteurs" {% if app.request.query.get('sort') == 'docteurs' %}selected{% endif %}>Nombre de docteurs</option>
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                            <select name="pays" class="rt-selectactive banner-select" style="width: 100%">
                                <option value="">Tous les pays</option>
                                <option value="France" {% if app.request.query.get('pays') == 'France' %}selected{% endif %}>France</option>
                                <option value="Allemagne" {% if app.request.query.get('pays') == 'Allemagne' %}selected{% endif %}>Allemagne</option>
                                <option value="Espagne" {% if app.request.query.get('pays') == 'Espagne' %}selected{% endif %}>Espagne</option>
                                <option value="Italie" {% if app.request.query.get('pays') == 'Italie' %}selected{% endif %}>Italie</option>
                            </select>
                        </div>
                        <div class="col-lg-3 rt-input-group mini col-md-6 mb-3 mb-md-0">
                            <select name="specialty" class="rt-selectactive banner-select" style="width: 100%">
                                <option value="">Toutes les spécialités</option>
                                {% for specialite in specialites %}
                                    <option value="{{ specialite.id_specialite }}" {% if app.request.query.get('specialty') == specialite.id_specialite %}selected{% endif %}>
                                        {{ specialite.nom }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <button type="submit" class="rt-btn rt-gradient pill rt-sm text-uppercase d-block w-100">Appliquer</button>
                        </div>

                        {# Garder les autres paramètres de recherche #}
                        {% if app.request.query.get('price_range') %}
                            <input type="hidden" name="price_range" value="{{ app.request.query.get('price_range') }}">
                        {% endif %}
                    </form>
                </div>

                {% for clinique in cliniques %}
                <div class="box-style__1 rt-mb-30">
                    <div class="hotel-inner-content row">
                        <div class="hotel-thumb col-md-3 mb-5 mb-md-0">
                            {% if clinique.cliniquePhotos|length > 0 %}
                                {# Accéder à la première photo avec first #}
                                <div class="hotel-bg rtbgprefix-cover" style="background-image: url('{{ asset(clinique.cliniquePhotos.first.photo_url) }}')"></div>
                            {% else %}
                                <div class="hotel-bg rtbgprefix-cover" style="background-image: url('{{ asset('images/mayoClinic.jpg') }}')"></div>
                            {% endif %}
                        </div>
                        <div class="hotel-text col-md-9">
                            <div class="top">
                                <h5>{{ clinique.nom }}</h5>
                                <!-- <p>{{ clinique.description|slice(0, 100) ~ '...' }}</p> -->
                                <p class="lead text-dark">{{ clinique.description }}</p>
                            </div>
                            <div class="middle-text d-md-flex justify-content-md-between rt-mt-20">
                                <div class="left_column">
                                    <span class="f-size-12 text-878">( {{ clinique.docteurs.count }} Docteurs )</span>
                                    <span class="text-555 f-size-16 d-block rt-mt-15">
                                        <span class="rt-mr-15"><i class="icofont-location-pin primary-color rt-mr-4"></i>{{ clinique.adresse }}</span>
                                    </span>
                                </div>
                                <div class="right_column text-left text-md-right">
                                    <span class="d-block text-primary f-size-24 rt-semiblod title-font">{{ clinique.prix|number_format(2) }} €</span>
                                    <span class="d-block f-size-12 text-878">Par consultation</span>
                                </div>
                            </div>
                            <div class="footer-elements d-flex justify-content-between align-items-center align-items-end">
                                <div class="left">
                                    <a href="#">Contactez-nous</a>
                                </div>
                                <div class="right">
                                    {% if clinique.id_clinique is not null %}
                                    <div class="right">
                                        <a href="{{ path('app_clinique_front_show', {'id_clinique': clinique.id_clinique}) }}" class="rt-btn rt-gradient pill rt-sm3 text-uppercase text-white">Voir Détails</a>
                                    </div>
                                    {% else %}
                                        <span class="text-muted">Détails indisponibles</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                    <p>Aucune clinique trouvée.</p>
                {% endfor %}

                <nav aria-label="Page navigation example">
                    <ul class="pagination rt-paganation justify-content-center">
                        {% if currentPage > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="{{ path('app_clinique_front_index', {'page': currentPage - 1}) }}">
                                    <i class="icofont-rounded-double-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        {% for i in 1..totalPages %}
                            <li class="page-item {{ currentPage == i ? 'active' : '' }}">
                                <a class="page-link" href="{{ path('app_clinique_front_index', {'page': i}) }}">
                                    {{ i }}
                                </a>
                            </li>
                        {% endfor %}

                        {% if currentPage < totalPages %}
                            <li class="page-item">
                                <a class="page-link" href="{{ path('app_clinique_front_index', {'page': currentPage + 1}) }}">
                                    <i class="icofont-rounded-double-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function() {
            // Récupérer les valeurs min et max depuis le contrôleur avec des valeurs par défaut
            const minPrice = {{ min_price is defined ? min_price : 0 }};
            const maxPrice = {{ max_price is defined ? max_price : 1000 }};
            const currentMinPrice = {{ current_min_price is defined ? current_min_price : min_price is defined ? min_price : 0 }};
            const currentMaxPrice = {{ current_max_price is defined ? current_max_price : max_price is defined ? max_price : 1000 }};

            $("#price-range").slider({
                range: true,
                min: minPrice,
                max: maxPrice,
                values: [currentMinPrice, currentMaxPrice],
                slide: function(event, ui) {
                    $("#price-amount").val(ui.values[0] + "€ - " + ui.values[1] + "€");
                },
                change: function(event, ui) {
                    // Mettre à jour la valeur cachée
                    $("input[name='price_range']").val(ui.values[0] + "," + ui.values[1]);
                }
            });

            // Initialiser l'affichage du prix
            $("#price-amount").val($("#price-range").slider("values", 0) +
                "€ - " + $("#price-range").slider("values", 1) + "€");
            
            // Définir la valeur initiale du champ caché
            $("input[name='price_range']").val(
                $("#price-range").slider("values", 0) + "," + 
                $("#price-range").slider("values", 1)
            );
        });
    </script>
{% endblock %}
