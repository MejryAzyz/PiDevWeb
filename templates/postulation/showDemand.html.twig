{% extends 'base.html.twig' %}

{% block title %}Postulation Demand Details{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1 class="rt-section-title">Postulation Demand Details</h1>
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('app_dashboard') }}">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Demand Details</li>
            </ol>
        </nav>

        <!-- Flash messages -->
        {% for message in app.flashes('success') %}
            <div class="alert alert-success mt-3">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('warning') %}
            <div class="alert alert-warning mt-3">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div class="alert alert-danger mt-3">{{ message }}</div>
        {% endfor %}

        <div class="row">
            <!-- Postulation Details -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-file-alt me-2 text-info"></i>Postulation Details</h5>
                        <table class="table table-bordered fs-14">
                            <tbody>
                            <tr>
                                <th>ID</th>
                                <td>{{ postulation.id_postulation() }}</td>
                            </tr>
                            <tr>
                                <th>Date</th>
                                <td>{{ postulation.datepostulation() ? postulation.datepostulation()|date('Y-m-d H:i') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td>
                                        <span class="badge {% if postulation.statut() == 'Accepted' %}bg-success{% elseif postulation.statut() == 'Rejected' %}bg-danger{% else %}bg-primary{% endif %}">
                                            {{ postulation.statut() }}
                                        </span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Accompagnateur Details -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-users me-2 text-primary"></i>Accompagnateur Details</h5>
                        {% if postulation.idaccompagnateur() and postulation.idaccompagnateur().Photo_profil %}
                            <img src="{{ asset('uploads/photos/' ~ postulation.idaccompagnateur().Photo_profil) }}" alt="Profile Photo" class="img-fluid rounded-circle mb-3" style="width: 100px; height: 100px; object-fit: cover;">
                        {% else %}
                            <img src="{{ asset('images/placeholder.jpg') }}" alt="No Photo" class="img-fluid rounded-circle mb-3" style="width: 100px; height: 100px; object-fit: cover;">
                        {% endif %}
                        <table class="table table-bordered fs-14">
                            <tbody>
                            <tr>
                                <th>Name</th>
                                <td>{{ postulation.idaccompagnateur() ? postulation.idaccompagnateur().name|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Username</th>
                                <td>{{ postulation.idaccompagnateur() ? postulation.idaccompagnateur().username|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Email</th>
                                <td>{{ postulation.idaccompagnateur() ? postulation.idaccompagnateur().email|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Phone</th>
                                <td>{{ postulation.idaccompagnateur() ? postulation.idaccompagnateur().phone|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>CV</th>
                                <td>
                                    {% if postulation.idaccompagnateur() and postulation.idaccompagnateur().fichier_cv %}
                                        <a href="{{ asset('uploads/' ~ postulation.idaccompagnateur().fichier_cv) }}" class="btn btn-sm btn-primary rt-rounded" download>
                                            <i class="fas fa-download me-1"></i> Download CV
                                        </a>
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- Offer Details -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-briefcase me-2 text-success"></i>Offer Details</h5>
                        <table class="table table-bordered fs-14">
                            <tbody>
                            <tr>
                                <th>Title</th>
                                <td>{{ postulation.idoffre() ? postulation.idoffre().titre|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Status</th>
                                <td>{{ postulation.idoffre() ? postulation.idoffre().etat|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Description</th>
                                <td>{{ postulation.idoffre() ? postulation.idoffre().description|default('N/A') : 'N/A' }}</td>
                            </tr>
                            <tr>
                                <th>Location</th>
                                <td>{{ postulation.idoffre() ? postulation.idoffre().location|default('N/A') : 'N/A' }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex gap-2 mt-3">
            <a href="{{ path('app_dashboard') }}" class="btn btn-secondary btn-sm rt-rounded">
                <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
            </a>
        </div>
    </div>
{% endblock %}

{% block css %}
    <style>
        .img-fluid.rounded-circle {
            border: 2px solid #dee2e6;
        }
        .table th {
            width: 30%;
        }
    </style>
{% endblock %}